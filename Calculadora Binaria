#include <stdio.h>
#include <string.h>
#include <stdlib.h>

//conversao decimais
void binario(int num1) {
    if (num1 == 0)
        printf("%d", num1);
    else {
        binario(num1 / 2);
        printf("%d", num1 % 2);
    }
}

void octal(int num1) {
    if (num1 == 0)
        printf("%d", num1);
    else {
        octal(num1 / 8);
        printf("%d", num1 % 8);
    }
}

void hexadecimal(int num1) {
    printf("%X\n", num1);
}
//conversao binario



//soma de numeros binarios
void inverter_bin (char *str) {
    int x, y;
    char temp;
    for (x = 0, y = strlen(str) - 1; x < y; x++, y--) {
        temp = str[x];
        str[x] = str[y];
        str[y] = temp;
    }
}
char* somaBin(const char *a, const char *b) {
    int lenA = strlen(a);
    int lenB = strlen(b);
    int maxLen = (lenA > lenB ? lenA : lenB) + 2;

    char *resultado = malloc(maxLen);
    if (!resultado) {
        printf("Numero Invalido");
        exit(1);
    }
    int x = lenA - 1, y = lenB - 1, k = 0, carry = 0;
    while (x >= 0 || y >= 0 || carry) {
        int bitA = (x >= 0) ? a[x--] - '0' : 0;
        int bitB = (y >= 0) ? b[y--] - '0' : 0;

        int soma = bitA + bitB + carry;
        resultado[k++] = (soma % 2) + '0';
        carry = soma / 2;
    }
    resultado[k] = '\0';
    inverter_bin(resultado);
    return resultado;
}

//subtracao de numeros binarios
char* subtracaoBin (const char *a, const char *b) {
    int lenA = strlen(a);
    int lenB = strlen(b);
    if ( lenB > lenA || (lenB == lenA && strcmp(b, a) > 0)) {
    printf("Digite um numero valido\n");
        return NULL;
    }
    int maxLen = lenA +1;
    char *resultado = (char *)malloc(maxLen);
    if (!resultado) {
        printf("Numero Invalido");
        exit(1);
    }
    int x = lenA -1, y = lenB -1, k = 0, borrow = 0;
    while (x >= 0) {
        int bitA = a[x] - '0';
        int bitB = (y >= 0) ? b[y] - '0' : 0;

        bitA -= borrow;

        if (bitA < bitB) {
            bitA += 2;
            borrow = 1;
        } else {
            borrow = 0;
        }
        resultado [k++] = (bitA - bitB) + '0';
        x--;
        y--;
    }
    while (k > 1 && resultado[k - 1] == '0') {
        k--;
    }
    resultado[k] = '\0';

    for (int x = 0, y = k-1; x < y; x++, y--) {
        char temp = resultado[x];
        resultado[x] = resultado[y];
        resultado[y] = temp;
    }
    return resultado;

}

//multiplicacao de numeros binarios


int main(void) {
    int escolha, esc2, esc3;
    char num1[100], num2[100];

    printf("Calculadora Binaria\n\n");
    printf("Selecione o processo que deseja realizar:\n");
    printf("1. Conversao de numeros binarios              2. Operacoes com numeros binarios\n");
    scanf("%d", &escolha);

    if (escolha == 1) {
        printf("Selecione o sistema pertencente ao numero que deseja converter:\n");
        printf("1. Decimal, 2. Binario, 3. Octal, 4. Hexadecimal\n");
        scanf("%d", &esc2);
        switch (esc2) {
            case 1:
                printf("Selecione o sistema que sera convertido:\n");
                printf("1. Binario, 2. Octal, 3. Hexadecimal\n");
                scanf("%d", &esc3);
                if (esc3 == 1) {
                    printf("digite o numero: ");
                    scanf("%d", &num1);
                    binario(num1);
                } else if (esc3 == 2) {
                    printf("digite o numero: ");
                    scanf("%d", &num1);
                    octal(num1);
                } else if (esc3 == 3) {
                    printf("Digite o numero: ");
                    scanf("%d", &num1);
                    hexadecimal(num1);
                } else {
                    printf("Insira uma resposta valida.");
                }
                break;
            case 2:
                printf("Selecione o sistema que sera convertido:\n");
                printf("1. Decimal, 2. Octal, 3. Hexadecimal\n");
                scanf("%d", &esc3);
                if (esc3 == 1) {
                    printf("Digite o numero: ");
                    scanf("%d", &num1);
                    // binario>decimal
                } else if (esc3 == 2) {
                    printf("Digite o numero: ");
                    scanf("%d", &num1);
                    // binario>octal
                } else if (esc3 == 3) {
                    printf("Digite o numero: ");
                    scanf("%d", &num1);
                    // binario>hex
                } else {
                    printf("Insira uma resposta valida.");
                }
                break;
            case 3:
                printf("Selecione o sistema que sera convertido:\n");
                printf("1. Decimal, 2. Binario, 3. Hexadecimal\n");
                scanf("%d", &esc3);
                if (esc3 == 1) {
                    printf("Digite o numero: ");
                    scanf("%d", &num1);
                    // octal>decimal
                } else if (esc3 == 2) {
                    printf("Digite o numero: ");
                    scanf("%d", &num1);
                    // octal>binario
                } else if (esc3 == 3) {
                    printf("Digite o numero: ");
                    scanf("%d", &num1);
                    // octal>hex
                } else {
                    printf("Insira uma resposta valida.");
                }
                break;
            case 4:
                printf("Selecione o sistema que sera convertido:\n");
                printf("1. Decimal, 2. Binario, 3. Octal\n");
                scanf("%d", &esc3);
                if (esc3 == 1) {
                    printf("Digite o numero: ");
                    scanf("%d", &num1);
                    // hex>decimal
                } else if (esc3 == 2) {
                    printf("Digite o numero: ");
                    scanf("%d", &num1);
                    // hex>binario
                } else if (esc3 == 3) {
                    printf("Digite o numero: ");
                    scanf("%d", &num1);
                    // hex>octal
                } else {
                    printf("Insira uma resposta valida.");
                }
                break;
            default:
                printf("Operacao Invalida");
        }
    } else if (escolha == 2) {
        printf("Selecione a operacao que deseja realizar:\n");
        printf("1. Soma, 2. Subtracao, 3. Multiplicacao, 4. Divisao\n");
        scanf("%d", &esc2);
        switch (esc2) {
            case 1:
                printf("Informe o primeiro numero da soma: \n");
                scanf("%s", num1);
                printf("Informe o segundo numero da soma: \n");
                scanf("%s", num2);
                char *resultado = somaBin(num1, num2);
                printf("Resultado: %s\n", resultado);
                free(resultado);
                break;
            case 2:
                printf("Informe o primeiro numero da subtracao: \n");
                scanf("%s", num1);
                printf("Informe o segundo numero da subtracao: \n");
                scanf("%s", num2);
                char *resultado_sub = subtracaoBin(num1, num2);
                if (resultado_sub != NULL) {
                    printf("Resultado: %s\n", resultado_sub);
                    free(resultado_sub);
                }
                break;
            case 3:
                printf("Informe o primeiro numero da multiplicacao: \n");
                scanf("%d", &num1);
                printf("Informe o segundo numero da multiplicacao: \n");
                scanf("%d", &num2);
                // operacao multiplicacao
                break;
            case 4:
                printf("Informe o primeiro numero da divisao: \n");
                scanf("%d", &num1);
                printf("Informe o segundo numero da divisao: \n");
                scanf("%d", &num2);
                // operacao divisao
                break;
            default:
                printf("Operacao Invalida");
        }
    } else {
        printf("Operacao Invalida");
    }

    return 0;
}
